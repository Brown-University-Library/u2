<div id="map"></div>
<script>
let map = L.map('map', {
    minZoom: 5,
    attributionControl: false,
    zoomControl: true,
}).setView([29, 31], 7);
const basemaps = {
    Topo: L.tileLayer('https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png', {
        attribution: 'Map data: &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, <a href="http://viewfinderpanoramas.org">SRTM</a> | Map style: &copy; <a href="https://opentopomap.org">OpenTopoMap</a> (<a href="https://creativecommons.org/licenses/by-sa/3.0/">CC-BY-SA</a>)'
    }),
    Outdoors: L.tileLayer('https://tiles.stadiamaps.com/tiles/outdoors/{z}/{x}/{y}{r}.{ext}', {
        attribution: '&copy; <a href="https://www.stadiamaps.com/" target="_blank">Stadia Maps</a> &copy; <a href="https://openmaptiles.org/" target="_blank">OpenMapTiles</a> &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
        ext: 'png'
    }),
    Terrain: L.tileLayer('https://tiles.stadiamaps.com/tiles/stamen_terrain/{z}/{x}/{y}{r}.{ext}', {
        attribution: '&copy; <a href="https://www.stadiamaps.com/" target="_blank">Stadia Maps</a> &copy; <a href="https://www.stamen.com/" target="_blank">Stamen Design</a> &copy; <a href="https://openmaptiles.org/" target="_blank">OpenMapTiles</a> &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
        ext: 'png'
    }),
    Satellite: L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
        attribution: 'Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community'
    })
};
basemaps.Satellite.addTo(map);

// 1960 geojson
/*var borderStyle = {
    "color": "#ffffff",
    "weight": 2,
    "fillOpacity": 0,
    "dashArray": "4 1 2",
};
var base1960 = new L.geoJson.ajax("https://raw.githubusercontent.com/aourednik/historical-basemaps/master/geojson/world_1960.geojson", { attribution: 'Historical border data from <a href="https://github.com/aourednik/historical-basemaps">Historical Basemaps</a>', style: borderStyle}).bindTooltip(function (layer) {
        return layer.feature.properties.NAME;
    });
*/
// Fake coverage areas
var fakeBounds = [
[29.993634,31.110074],
[29.950140,31.220556],
[29.847314,31.163250],
[29.909425,30.956741]
    ]
var bdroverlay = L.imageOverlay("/804-now.jpg",[fakeBounds], {opacity:1, interactive: true});
bdroverlay.on('click', function(d) {
    event.preventDefault(); //to avoid changes the current page url
        window.open('https://repository.library.brown.edu/viewers/mirador/bdr:321832',);//the behavior is defined by the browser and user options
        return false;//It prevents the default action associated with the event

});
var rect = L.polygon(fakeBounds, {fillOpacity: 0.1,color: "red"});
var laurel = L.layerGroup([rect,bdroverlay]);
/*var rect2 = L.polygon([
    [26.59, 32.11],
    [27.503, 31.22],
    [28.41, 31.27],
    [28.71, 32.57]
]).bindPopup("more shape");

var circle = L.circle([29.41, 30.27], {
    radius: 8000, // in meters
    fillColor: '#ff7800'
}).bindPopup("a circle!");
*/
/*var latlngs = [
    [ // first polygon
        [
            [25, 32.05],
            [27, 31.03],
            [29, 31.05],
            [30, 31.99]
        ],
    ],
    [ // second polygon
        [
            [30, 31.03],
            [29.288, 30.04],
            [29.44,30.88],
            [29.97,30.98],
            [30.448, 31.05],
            [30.274, 32.05]
        ]
    ]
];

var goofy = L.polygon(latlngs).addTo(map);

var shapes = L.layerGroup([rect, rect2, circle, goofy]);
*/
// mission paths
var longFlight = [
[31.01919235,29.76390976],
[31.00988611,29.82660125],
[31.00225577,29.89840881],
[30.98992895,30.03765766],
[30.9850649,30.11034572],
[30.97582333,30.18213412],
[30.96695583,30.24838976],
[30.95425179,30.32020348],
[30.98584979,30.74579322],
[30.99128684,30.88347861],
[30.98982067,31.0282153],
[30.98569399,31.16198038],
[30.99289,31.2924676],
[30.9934004,31.41140475],
[30.93942865,31.69266698],
[30.86848988,31.76505107],
[30.96109944,32.50255748],
[31.11695775,32.61923778],
[31.18331894,32.82056366],
[31.35185018,33.58331612],
[30.94519274,33.74892589],
[30.81817409,33.70586942],
[30.72308444,33.6522092],
[30.59889122,33.58854239],
[30.50399362,33.57078669],
[30.38226851,33.54208007],
[30.27251799,33.49675572],
[30.2275333,33.32844527],
[30.34450917,33.23259465],
[30.39676283,33.121669],
[30.44457223,33.0083253],
[30.49790933,32.88013028],
[30.54471104,32.33003303],
[30.53857608,32.59290528],
[30.52834551,32.26601881],
[30.53863005,32.13820829],
[30.53969799,32.00592646],
[30.5393621,31.87560107],
[30.54485256,31.74116235],
[30.54409762,31.61840704],
[30.5410965,31.48009177],
[30.5284015,31.34079188],
[30.52366108,31.21421928],
[30.50170533,31.0848408],
[30.50111936,30.95815945],
[30.50058638,30.82605136],
[29.99971968,30.29368764],
[30.12128965,31.03566547],
[30.1241339,31.16573808],
[30.11537238,31.30779045],
[30.11670865,31.49125075],
[30.08142787,31.72978933],
[30.10093344,31.88463234],
[30.10518517,32.01336633],
[30.12324479,32.15455797],
[30.12197109,32.28497742],
[30.14301994,32.43657476],
[30.14527167,32.56942264],
[30.19157982,32.90590887],
[30.05426093,32.99479104],
[29.96858321,32.87112925],
[29.99651266,32.72243592],
[29.96626443,32.53880566],
[29.95201149,32.37680005],
[29.91480965,32.27248701],
[29.88422563,32.15874451],
[29.89402404,32.02240602],
[29.89050403,31.88557769],
[29.88217358,31.76297368],
[29.88089125,31.63760501],
[29.90095517,31.49886316],
[29.89771183,31.37176305],
[29.90314639,31.24005125],
[29.90485732,31.17384484],
[29.51847699,30.94888609],
[29.4893085,31.09591592],
[29.42389172,31.20094963],
[29.38618445,31.26049352],
[29.31762494,31.37834724],
[29.2499604,31.48236498],
[28.3807644,32.85342484],
[27.6484237,33.93400004],
[27.58260644,33.87610507],
[27.42983751,33.81420955],
[27.33461777,33.7418076],
[27.25123449,33.6503894],
[27.15105383,33.58373267],
[27.0471779,33.52282709],
[26.96104468,33.40892655],
[26.89452877,33.28582172],
[26.78283401,33.2216966],
[26.65841797,33.08417943],
[26.55154198,33.00272943],
[26.45691024,32.90724139],
[26.36104429,32.82995164],
[26.27017861,32.75407133],
[26.23696131,32.71418939],
[26.19730189,32.61109582],
[26.06451633,32.61404703],
[26.01015895,32.68883735],
[25.8800507,32.69502149],
[25.77440923,32.701763],
[25.65236525,32.70061106],
[25.5324831,32.70615503],
[25.4050729,32.7175707],
[25.29271494,32.73279815],
[25.17609143,32.73505165],
[25.05727329,32.76844297],
[24.87560751,32.8027743],
[24.75735479,32.82317181],
[24.64390785,32.85098728],
[24.52790341,32.8620456],
[24.40924671,32.87744602],
[24.28835526,32.89554913],
[24.18417859,32.91162442],
[24.05650621,32.92515983],
[23.89497233,32.94439984],
[23.82229046,32.97902841],
[23.76724289,32.98345102],
[23.6081734,33.24762432],
[23.66602371,33.37044075],
[27.03449847,35.84589441],
[27.06894493,35.99275911],
[27.17330554,36.07018728],
[27.28406902,36.1201749],
[27.34205143,36.22984296],
[27.43775095,36.31931846],
[27.51782063,36.40245949],
[27.60194342,36.49463451],
[27.71701022,36.64608166],
[27.75842741,36.69436689],
[27.86144071,36.77900174],
[27.9364986,36.86731208],
[28.02226271,36.96900378],
[28.13440577,37.04906985],
[28.25184388,37.18059999],
[28.35078352,37.24746031],
[28.44662059,37.34571653],
[28.55343742,37.40981118],
[28.56978671,37.46580699],
[28.48781389,37.69785904],
[28.6403077,37.56917849],
[33.18707551,42.99233793],
[33.10457684,42.90271783],
[33.46531721,42.68667046],
[33.34600575,42.36715196],
[33.19501634,41.7064961],
[33.0875217,41.42950918],
[33.05984747,41.28512505],
[33.05383898,41.15147288],
[33.0058478,41.01117492],
[32.979707,40.8404695],
[32.96254504,40.73555908],
[32.9341989,40.5867364],
[32.91239612,40.45211762],
[32.89802216,40.3023754],
[32.86209841,40.18107356],
[32.83576547,40.03579078],
[32.84051556,39.90419832],
[32.82521079,39.76438346],
[32.81343845,39.4902731],
[32.83468888,39.37512868],
[32.87678088,39.2310591],
[32.88400362,39.06136682],
[32.81459889,38.92749218],
[32.7819211,38.79917489],
[32.7537091,38.65980368],
[32.72509144,38.5104979],
[32.6831726,38.31187746],
[32.60449515,38.19016078],
[32.57048735,38.14093266],
[32.51206852,38.03109358],
[32.49857337,37.89311369],
[32.45499786,37.76293246],
[32.43572351,37.63416564],
[32.41513583,37.50404259],
[32.40836363,37.37896938],
[32.41162928,37.22614467],
[32.37793345,37.08635543],
[32.36265341,36.94930983],
[32.33328505,36.81474011],
[32.3063804,36.68554151],
[32.28701681,36.55072846],
[32.28070203,36.32880901],
[32.13834453,36.26586165],
[32.06483062,36.39382478],
[31.93437962,36.32108487],
[31.79899961,36.36182368],
[31.69003588,36.35459352],
[31.57333236,36.34427084],
[31.5334371,36.28913827],
[31.48207694,36.33471665],
[31.74729533,36.18155571],
[31.80653611,36.18309734],
[31.84723623,36.16676375],
[31.90950932,36.18953384],
[32.09044081,36.2202239],
[32.20384878,36.24847077],
[32.3340281,36.2346587],
[32.45024735,36.20050894],
[32.58305146,36.19082313],
[32.69417291,36.19126154],
[32.81077085,36.16906349],
[32.92819764,36.14968969],
[33.04173955,36.11938127],
[33.16360368,36.11639317],
[33.27303389,36.09683093],
[33.39675045,36.10717064],
[33.52036446,36.08590662],
[33.62862982,36.09540119],
[33.69202742,36.06165082],
[33.75886695,36.07812373],
[33.86113137,36.00099931],
[33.9007104,36.18306654],
[33.96187396,36.06177111],
[33.98870968,36.12551426],
[33.93495996,36.24972159],
[33.97024544,36.31063917],
[33.87125279,36.39740562],
[33.80373634,36.38888217],
[33.74572054,36.4131051],
[33.6498341,36.51000857],
[33.53463365,36.57903154],
[33.49299238,36.60911877],
[33.43400169,36.6525564],
[33.33539462,36.73468119],
[33.23646374,36.81002713],
[33.19264112,36.84085045],
[33.13065506,36.88254695],
[33.03307675,36.95889708],
[32.94402617,37.00897272],
[32.89406661,36.86823578],
[32.97403889,36.6590388],
[32.75852549,36.55658659],
[32.62983181,36.57313809],
[32.55002318,36.68085966],
[32.51240779,36.9649111],
[32.6770685,37.18830351],
[32.80756976,37.10414752],
[32.86666922,37.12473596],
[32.9893135,37.10999767],
[33.09043779,37.17912779],
[33.14632162,37.18907913],
[33.20033143,37.21150693],
[33.24102598,37.28343537],
[33.30840927,37.26489701],
[33.42438263,37.32044524],
[33.53744065,37.34921023],
[33.66029183,37.37745061],
[33.7645899,37.41581497],
[33.81616188,37.65954517],
[33.95539073,37.74739395],
[33.97673244,37.83108347],
[34.01851402,37.87621087],
[34.04438029,37.96818329],
[34.10620225,37.9888842],
[34.18199945,38.09799261],
[34.26647322,38.20814766],
[34.35064455,38.31056954],
[34.40241497,38.47740863],
[34.63827773,38.52437903],
[34.77243651,38.47290732],
[34.72199632,38.28076925],
[34.80717309,38.179614],
[34.85417184,38.13211779],
[34.8750216,38.06702229],
[34.93920586,38.03461804],
[34.95188764,37.95189501],
[35.06112942,37.78848764],
[35.10654978,37.72698136],
[35.17831746,37.61443631],
[35.25102823,37.50979152],
[35.29896636,37.44705585],
[35.37933495,37.35377888],
[35.40291714,37.29046793],
[35.50450579,37.12765676],
[35.47115868,37.16910253],
[35.52358709,37.05752502],
[35.59414046,37.03621064],
[35.61628255,36.96813102],
[35.69897997,36.8691735],
[35.7962743,36.80877482],
[35.85326918,36.75895326],
[35.89944848,36.72580727],
[36.81417359,34.58040442],
[36.80353727,34.53590519],
[36.78984727,34.48976305],
[36.78119056,34.45317912],
[36.75033683,34.40922485],
[36.74332023,34.36415257],
[36.73188731,34.29685315],
[36.70569349,34.26034695],
[36.69521943,34.21164763],
[36.67821654,34.15304451],
[36.65777891,34.09687881],
[36.6271078,34.04328937],
[36.22723311,32.31097844],
[36.20521382,32.24517591],
[36.24062514,32.37497524],
[36.58950912,33.87748062],
[36.57657297,33.8147895],
[36.56905368,33.76296668],
[36.52921701,33.56416592],
[36.46209563,33.24795054],
[36.43272389,32.9301358],
[36.82023185,34.64968681],
[36.8253487,34.67377104],
[36.83744024,34.71276796],
[36.84824845,34.74761441],
[36.86021359,34.8021868],
[33.54794468,42.96771706],
]
var longFlight = L.polyline(longFlight, { color: 'red' });
var flights = L.layerGroup([longFlight]);

var bdrImages = L.layerGroup();
// Pyramids from geojson in /static folder
// fetch the geojson
var pyramids = new L.GeoJSON.AJAX("/pyramids.geojson", {
    // build each point
    onEachFeature: function(feature, layer) {
        // Check if feature is a polygon
        if (feature.geometry.type === 'Polygon') {
            // Don't stroke and do opaque fill
            layer.setStyle({
                'color': 'red',
                'weight': 2,
                'fillOpacity': 0
            });
            if (feature.properties.pid ) {
                var imageUrl = `https://dlibbdrwwwcit.services.brown.edu/studio/thumbnail/` + feature.properties.pid;
                // Get bounds of polygon
                var bounds = layer.getBounds();
                var popupText = '<a href="https://dlibbdrwwwcit.services.brown.edu/studio/items/' + feature.properties.pid + '">' + feature.properties.name + '</a>' ;
                L.imageOverlay(imageUrl, bounds).addTo(bdrImages);
            } else {
                var popupText = feature.properties.name;
            }
            layer.bindPopup(popupText);
        }
    }
});

var realthings = L.layerGroup([pyramids,bdrImages]);

// establish the overlays
var overlayMaps = {
    "Pyramids with BDR images": realthings,
    "Flight paths": flights,
    "!": laurel
};

// Allow user to choose what overlays to display
const layerControl = L.control.layers(basemaps, overlayMaps, { collapsed: false, position: 'topright' }).addTo(map);

// Provide coordinates of mouse
var c = new L.Control.Coordinates({position:'topright'});

c.addTo(map);

map.on('click', function(e) {
    c.setCoordinates(e);
});
</script>
